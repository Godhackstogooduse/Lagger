local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer

-- GUI SETUP (ResetOnSpawn = false makes it permanent)
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "AbyssHubV6"
screenGui.ResetOnSpawn = false 
screenGui.IgnoreGuiInset = true
screenGui.Parent = (game:GetService("CoreGui") or player:WaitForChild("PlayerGui"))

local main = Instance.new("Frame")
main.Size = UDim2.new(0, 280, 0, 320)
main.Position = UDim2.new(0.5, -140, 0.4, 0)
main.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
main.BorderSizePixel = 0
main.Active = true
main.Parent = screenGui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 10)
corner.Parent = main

local stroke = Instance.new("UIStroke")
stroke.Thickness = 2
stroke.Color = Color3.fromRGB(40, 40, 40)
stroke.Parent = main

-- CUSTOM DRAG SYSTEM
local dragging, dragInput, dragStart, startPos
main.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		dragging = true
		dragStart = input.Position
		startPos = main.Position
	end
end)
main.InputChanged:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseMovement then dragInput = input end
end)
UIS.InputChanged:Connect(function(input)
	if input == dragInput and dragging then
		local delta = input.Position - dragStart
		main.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
	end
end)
UIS.InputEnded:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end
end)

-- TITLE
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 40)
title.Text = "ABYSS NETWORK MOD"
title.TextColor3 = Color3.fromRGB(200, 50, 255)
title.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
title.Font = Enum.Font.GothamBold
title.TextSize = 14
title.Parent = main

-- SETTINGS STORAGE (Persists through death)
_G.AbyssSpeed = 16
_G.AbyssLag = 0

-- SPEED SECTION
local speedLabel = Instance.new("TextLabel")
speedLabel.Size = UDim2.new(1, -20, 0, 20)
speedLabel.Position = UDim2.new(0, 10, 0, 55)
speedLabel.Text = "CUSTOM SPEED BOOSTER"
speedLabel.TextColor3 = Color3.new(0.8, 0.8, 0.8)
speedLabel.BackgroundTransparency = 1
speedLabel.Font = Enum.Font.GothamBold
speedLabel.TextSize = 12
speedLabel.TextXAlignment = "Left"
speedLabel.Parent = main

local speedBox = Instance.new("TextBox")
speedBox.Size = UDim2.new(0.9, 0, 0, 40)
speedBox.Position = UDim2.new(0.05, 0, 0, 80)
speedBox.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
speedBox.Text = tostring(_G.AbyssSpeed)
speedBox.TextColor3 = Color3.new(1, 1, 1)
speedBox.Font = Enum.Font.Gotham
speedBox.PlaceholderText = "Set WalkSpeed..."
speedBox.Parent = main

-- SLIDER (PACKET INTENSITY)
local lagLabel = Instance.new("TextLabel")
lagLabel.Size = UDim2.new(1, -20, 0, 20)
lagLabel.Position = UDim2.new(0, 10, 0, 135)
lagLabel.Text = "PACKET STRESS: 0%"
lagLabel.TextColor3 = Color3.fromRGB(200, 50, 255)
lagLabel.BackgroundTransparency = 1
lagLabel.Font = Enum.Font.GothamBold
lagLabel.TextSize = 12
lagLabel.TextXAlignment = "Left"
lagLabel.Parent = main

local sliderFrame = Instance.new("Frame")
sliderFrame.Size = UDim2.new(0.9, 0, 0, 10)
sliderFrame.Position = UDim2.new(0.05, 0, 0, 165)
sliderFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
sliderFrame.Parent = main

local sliderFill = Instance.new("Frame")
sliderFill.Size = UDim2.new(0, 0, 1, 0)
sliderFill.BackgroundColor3 = Color3.fromRGB(200, 50, 255)
sliderFill.BorderSizePixel = 0
sliderFill.Parent = sliderFrame

local knob = Instance.new("TextButton")
knob.Size = UDim2.new(0, 18, 0, 18)
knob.Position = UDim2.new(0, -9, 0.5, -9)
knob.BackgroundColor3 = Color3.new(1, 1, 1)
knob.Text = ""
knob.Parent = sliderFill
Instance.new("UICorner", knob).CornerRadius = UDim.new(1, 0)

-- SLIDER LOGIC
local function updateSlider()
	local mousePos = UIS:GetMouseLocation().X
	local framePos = sliderFrame.AbsolutePosition.X
	local frameWidth = sliderFrame.AbsoluteSize.X
	local percentage = math.clamp((mousePos - framePos) / frameWidth, 0, 1)
	
	sliderFill.Size = UDim2.new(percentage, 0, 1, 0)
	lagLabel.Text = "PACKET STRESS: " .. math.floor(percentage * 100) .. "%"
	
	-- "Harder" Packets: Scale up to 30 seconds of lag
	_G.AbyssLag = percentage * 30
	settings().Network.IncomingReplicationLag = _G.AbyssLag
end

local isSliding = false
knob.MouseButton1Down:Connect(function() isSliding = true end)
UIS.InputEnded:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then isSliding = false end
end)
UIS.InputChanged:Connect(function(input)
	if isSliding and input.UserInputType == Enum.UserInputType.MouseMovement then
		updateSlider()
	end
end)

-- ABYSSAL FLOOD (INSTANT MAX)
local floodBtn = Instance.new("TextButton")
floodBtn.Size = UDim2.new(0.9, 0, 0, 45)
floodBtn.Position = UDim2.new(0.05, 0, 0, 200)
floodBtn.BackgroundColor3 = Color3.fromRGB(150, 0, 0)
floodBtn.Text = "GLOBAL ABYSS: OFF"
floodBtn.TextColor3 = Color3.new(1, 1, 1)
floodBtn.Font = Enum.Font.GothamBold
floodBtn.Parent = main

local floodOn = false
floodBtn.MouseButton1Click:Connect(function()
	floodOn = not floodOn
	if floodOn then
		floodBtn.Text = "GLOBAL ABYSS: ACTIVE"
		floodBtn.BackgroundColor3 = Color3.fromRGB(0, 150, 0)
		settings().Network.IncomingReplicationLag = 9e9 -- Hard Freeze
	else
		floodBtn.Text = "GLOBAL ABYSS: OFF"
		floodBtn.BackgroundColor3 = Color3.fromRGB(150, 0, 0)
		settings().Network.IncomingReplicationLag = _G.AbyssLag
	end
end)

-- NO RESET LOGIC: Re-applies speed whenever you spawn
task.spawn(function()
	while true do
		local char = player.Character
		if char then
			local hum = char:FindFirstChild("Humanoid")
			if hum then
				hum.WalkSpeed = _G.AbyssSpeed
			end
		end
		task.wait(1)
	end
end)

speedBox.FocusLost:Connect(function()
	_G.AbyssSpeed = tonumber(speedBox.Text) or 16
end)

local resync = Instance.new("TextButton")
resync.Size = UDim2.new(0.9, 0, 0, 35)
resync.Position = UDim2.new(0.05, 0, 0, 260)
resync.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
resync.Text = "emergency Resync"
resync.TextColor3 = Color3.new(1,1,1)
resync.Font = Enum.Font.Gotham
resync.Parent = main

resync.MouseButton1Click:Connect(function()
	_G.AbyssLag = 0
	settings().Network.IncomingReplicationLag = 0
	sliderFill.Size = UDim2.new(0,0,1,0)
	lagLabel.Text = "PACKET STRESS: 0%"
	floodOn = false
	floodBtn.Text = "GLOBAL ABYSS: OFF"
end)
