local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")

-- Select the best place to put the UI
local parentUI = nil
local success, coreGui = pcall(function() return game:GetService("CoreGui") end)
if success and coreGui then
    parentUI = coreGui
else
    parentUI = player:WaitForChild("PlayerGui")
end

-- MAIN UI CONTAINER
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "UltimateHackGui"
screenGui.ResetOnSpawn = false
screenGui.IgnoreGuiInset = true -- Makes it ignore top bar
screenGui.Parent = parentUI

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 220, 0, 280)
mainFrame.Position = UDim2.new(0.05, 0, 0.4, 0)
mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
mainFrame.BorderSizePixel = 2
mainFrame.Active = true
mainFrame.Draggable = true
mainFrame.Parent = screenGui

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 40)
title.Text = "MULTIPURPOSE TOOL"
title.TextColor3 = Color3.new(1, 1, 1)
title.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
title.Font = Enum.Font.SourceSansBold
title.TextSize = 18
title.Parent = mainFrame

-- Helper Function to Create Buttons
local function createButton(name, pos, color)
    local btn = Instance.new("TextButton")
    btn.Name = name
    btn.Size = UDim2.new(0.9, 0, 0, 45)
    btn.Position = UDim2.new(0.05, 0, 0, pos)
    btn.BackgroundColor3 = color
    btn.TextColor3 = Color3.new(1, 1, 1)
    btn.Font = Enum.Font.SourceSansBold
    btn.TextSize = 16
    btn.BorderSizePixel = 0
    btn.Parent = mainFrame
    
    -- Round UI Corners
    local corner = Instance.new("UICorner")
    corner.CornerRadius = ToolPunch.new(0, 8)
    corner.Parent = btn
    
    return btn
end

-- CREATE THE BUTTONS
local speedBtn = createButton("Speed: OFF", 60, Color3.fromRGB(200, 50, 50))
local lagBtn = createButton("Packet Lag: OFF", 115, Color3.fromRGB(200, 50, 50))
local freezeBtn = createButton("Screen Freeze: OFF", 170, Color3.fromRGB(200, 50, 50))
local blinkBtn = createButton("Blink (Stay Still): OFF", 225, Color3.fromRGB(200, 50, 50))
mainFrame.Size = UDim2.new(0, 220, 0, 285) -- Adjust height

-- LOGIC VARIABLES
local speedToggle = false
local lagToggle = false
local freezeToggle = false
local blinkToggle = false
local ghost = nil

-- 1. SPEED BOOSTER
speedBtn.MouseButton1Click:Connect(function()
    speedToggle = not speedToggle
    if speedToggle then
        speedBtn.Text = "Speed: ON (100)"
        speedBtn.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
        humanoid.WalkSpeed = 100
    else
        speedBtn.Text = "Speed: OFF"
        speedBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
        humanoid.WalkSpeed = 16
    end
end)

-- 2. PACKET LAG (500ms)
lagBtn.MouseButton1Click:Connect(function()
    lagToggle = not lagToggle
    if lagToggle then
        lagBtn.Text = "Packet Lag: ON"
        lagBtn.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
        settings().Network.IncomingReplicationLag = 0.5
    else
        lagBtn.Text = "Packet Lag: OFF"
        lagBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
        settings().Network.IncomingReplicationLag = 0
    end
end)

-- 3. NETWORK FREEZE (Permanent Lag)
freezeBtn.MouseButton1Click:Connect(function()
    freezeToggle = not freezeToggle
    if freezeToggle then
        freezeBtn.Text = "FREEZE: ON"
        freezeBtn.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
        settings().Network.IncomingReplicationLag = 9e9
    else
        freezeBtn.Text = "FREEZE: OFF"
        freezeBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
        settings().Network.IncomingReplicationLag = 0
    end
end)

-- 4. CHARACTER BLINK (Stay Still)
blinkBtn.MouseButton1Click:Connect(function()
    blinkToggle = not blinkToggle
    if blinkToggle then
        blinkBtn.Text = "Blink: ACTIVE"
        blinkBtn.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
        
        -- Create Ghost Marker
        ghost = Instance.new("Part")
        ghost.Size = Vector3.new(2, 2, 1)
        ghost.CFrame = character.HumanoidRootPart.CFrame
        ghost.Anchored = true
        ghost.CanCollide = false
        ghost.Color = Color3.new(1, 0, 0)
        ghost.Transparency = 0.5
        ghost.Parent = workspace
        
        settings().Network.IncomingReplicationLag = 9e9
    else
        blinkBtn.Text = "Blink: OFF"
        blinkBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
        if ghost then ghost:Destroy() end
        settings().Network.IncomingReplicationLag = 0
    end
end)

-- AUTO RE-SYNC ON CHARACTER SPAWN
player.CharacterAdded:Connect(function(newChar)
    character = newChar
    humanoid = newChar:WaitForChild("Humanoid")
    if speedToggle then humanoid.WalkSpeed = 100 end
end)
