-- LocalScript inside StarterPlayerScripts or StarterCharacterScripts

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- === CONFIG ===
local EFFECT_DURATION = 3  -- seconds the effect lasts
local SHAKE_INTENSITY = 15  -- camera shake strength

-- === CREATE UI ===
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "LagEffectGui"
screenGui.ResetOnSpawn = false
screenGui.Parent = playerGui

-- Overlay (glitch/blur tint)
local overlay = Instance.new("Frame")
overlay.Size = UDim2.new(1, 0, 1, 0)
overlay.Position = UDim2.new(0, 0, 0, 0)
overlay.BackgroundColor3 = Color3.fromRGB(0, 200, 255)
overlay.BackgroundTransparency = 1
overlay.ZIndex = 10
overlay.Parent = screenGui

-- Glitch label
local glitchLabel = Instance.new("TextLabel")
glitchLabel.Size = UDim2.new(1, 0, 0, 60)
glitchLabel.Position = UDim2.new(0, 0, 0.4, 0)
glitchLabel.BackgroundTransparency = 1
glitchLabel.TextColor3 = Color3.fromRGB(255, 50, 50)
glitchLabel.Font = Enum.Font.Code
glitchLabel.TextSize = 36
glitchLabel.Text = ""
glitchLabel.ZIndex = 11
glitchLabel.Parent = screenGui

-- Toggle Button
local toggleBtn = Instance.new("TextButton")
toggleBtn.Size = UDim2.new(0, 180, 0, 50)
toggleBtn.Position = UDim2.new(0, 20, 0, 20)
toggleBtn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
toggleBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleBtn.Font = Enum.Font.GothamBold
toggleBtn.TextSize = 16
toggleBtn.Text = "âš¡ Trigger Lag Effect"
toggleBtn.ZIndex = 12
toggleBtn.Parent = screenGui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 8)
corner.Parent = toggleBtn

-- === EFFECT LOGIC ===
local effectActive = false
local camera = workspace.CurrentCamera

local glitchMessages = {
    "LAG", "ERR_0x4F", "TIMEOUT", "...", "LAG", "PACKET LOSS", "????",
}

local function triggerLagEffect()
    if effectActive then return end
    effectActive = true
    toggleBtn.Text = "ðŸ”´ Effect Active..."
    toggleBtn.BackgroundColor3 = Color3.fromRGB(180, 30, 30)

    local startTime = tick()
    local originalCFrame = camera.CFrame

    -- Tween overlay in
    TweenService:Create(overlay, TweenInfo.new(0.1), {BackgroundTransparency = 0.75}):Play()

    local connection
    connection = RunService.RenderStepped:Connect(function()
        local elapsed = tick() - startTime

        if elapsed >= EFFECT_DURATION then
            -- Clean up
            connection:Disconnect()
            TweenService:Create(overlay, TweenInfo.new(0.3), {BackgroundTransparency = 1}):Play()
            glitchLabel.Text = ""
            effectActive = false
            toggleBtn.Text = "âš¡ Trigger Lag Effect"
            toggleBtn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
            return
        end

        -- Camera shake
        local shakeX = (math.random() - 0.5) * SHAKE_INTENSITY * 0.1
        local shakeY = (math.random() - 0.5) * SHAKE_INTENSITY * 0.1
        camera.CFrame = camera.CFrame * CFrame.new(shakeX, shakeY, 0)

        -- Glitch text flicker
        if math.random() > 0.6 then
            glitchLabel.Text = glitchMessages[math.random(#glitchMessages)]
            glitchLabel.Position = UDim2.new(
                math.random() * 0.1, 0,
                0.35 + math.random() * 0.1, 0
            )
        else
            glitchLabel.Text = ""
        end

        -- Overlay color flicker
        if math.random() > 0.8 then
            overlay.BackgroundColor3 = Color3.fromRGB(math.random(200,255), 0, math.random(0,100))
        end
    end)
end

toggleBtn.MouseButton1Click:Connect(triggerLagEffect)
